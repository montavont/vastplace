<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Trace File Map display</title>   
        <meta http-equiv="{{ reload_action }}" content="{{ reload_content }}" />
    	<link rel="stylesheet" href="https://openlayers.org/en/v4.1.1/css/ol.css" type="text/css">
	    <style>
	      .map {
	        height: 600px;
	        width: 100%;
	      }
	</style>
	<script src="https://openlayers.org/en/v4.1.1/build/ol.js" type="text/javascript"></script>
    </head>
  <body>

    <div id="map" class="map"></div>
    <script type="text/javascript">


	var lineFeatures = [
        {% for traj in trajectories %}
		new ol.Feature(new ol.geom.LineString([
		{% for p in traj.points %}
	        	new ol.proj.fromLonLat({{p}}),
		{% endfor %}
	        ])),
        {% endfor %}
	];
		

	var pointFeatures = [
	{% for p in points %}
		new ol.Feature({
			'geometry':new ol.geom.Point(ol.proj.fromLonLat({{p.lonlat}})),
	    		'style': '{{p.style}}',
		}),
	{% endfor %}
	];



  var pointStyles = {
        'red': new ol.style.Style({
          image: new ol.style.Circle({
            radius: 5,
            fill: new ol.style.Fill({color: 'red'}),
          })
        }),
        'green': new ol.style.Style({
          image: new ol.style.Circle({
            radius: 10,
            fill: new ol.style.Fill({color: 'green'}),
          })
        }),
        'empty_blue': new ol.style.Style({
          image: new ol.style.Circle({
            radius: 10,
            fill: new ol.style.Fill({color: '#00000000'}),
            stroke: new ol.style.Stroke({
	            color: 'blue',
        	    width: 3
          	})
          })
        })
      };

      var vectorSource = new ol.source.Vector({
        features: pointFeatures,
        wrapX: false
      });
      var vector = new ol.layer.Vector({
        source: vectorSource,
        style: function(feature) {
          return pointStyles[feature.get('style')];
        }
      });


      var map = new ol.Map({
        target: 'map',
        layers: [
          new ol.layer.Tile({
            source: new ol.source.OSM()
          }),
	  new ol.layer.Vector({
            source: new ol.source.Vector({
                features: lineFeatures,
            }),
	    style: new ol.style.Style({
          	stroke: new ol.style.Stroke({
	            color: 'black',
        	    width: 3
          	})
            })
            }),
	  vector
        ],
        view: new ol.View({
          center: ol.proj.fromLonLat({{ trajectories.0.points.0 }}),
          zoom: 16
        })
      });

    </script>

  </body>
</html>
